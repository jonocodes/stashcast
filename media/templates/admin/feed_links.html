{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Feed Links{% endblock %}

{% block extrastyle %}
<style>
    :root {
        --sc-panel-bg: var(--body-bg, #ffffff);
        --sc-panel-fg: var(--body-fg, #222222);
        --sc-muted: var(--body-quiet-color, #6b7280);
        --sc-border: var(--hairline-color, #d4d4d4);
        --sc-primary: var(--primary, #417690);
        --sc-primary-fg: var(--primary-fg, #ffffff);
        --sc-surface: var(--darkened-bg, rgba(0,0,0,0.02));
    }
    .container {
        background: var(--sc-panel-bg);
        color: var(--sc-panel-fg);
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border: 1px solid var(--sc-border);
    }
    h1 {
        color: var(--sc-panel-fg);
        margin-top: 0;
    }
    h2 {
        color: var(--sc-panel-fg);
        margin-top: 30px;
        border-bottom: 2px solid var(--sc-primary);
        padding-bottom: 10px;
    }
    .explainer {
        background: color-mix(in srgb, var(--sc-surface) 70%, transparent);
        border-left: 4px solid var(--sc-primary);
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
        border: 1px solid var(--sc-border);
    }
    .status-info {
        padding: 15px;
        border-radius: 4px;
        margin: 20px 0;
        border: 1px solid;
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }
    .status-info.protected {
        background: color-mix(in srgb, #22c55e 10%, transparent);
        border-color: #22c55e;
    }
    .status-info.public {
        background: color-mix(in srgb, #f59e0b 10%, transparent);
        border-color: #f59e0b;
    }
    .status-info-icon {
        font-size: 20px;
        flex-shrink: 0;
    }
    code {
        background: rgba(0, 0, 0, 0.1);
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
    }
    .feed-card {
        background: var(--sc-surface);
        border: 1px solid var(--sc-border);
        border-radius: 8px;
        padding: 20px;
        margin: 15px 0;
        display: flex;
        gap: 20px;
        align-items: flex-start;
    }
    .feed-card img {
        width: 100px;
        height: auto;
        border-radius: 6px;
        background: var(--sc-panel-bg);
        padding: 8px;
        flex-shrink: 0;
    }
    .feed-card-content {
        flex: 1;
        min-width: 0;
    }
    .feed-card h3 {
        margin: 0 0 10px 0;
        color: var(--sc-panel-fg);
    }
    .feed-url-group {
        margin: 10px 0;
    }
    .feed-url-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--sc-panel-fg);
        font-size: 13px;
    }
    .feed-url-input {
        display: flex;
        gap: 8px;
    }
    .feed-url-input input {
        flex: 1;
        padding: 10px;
        border: 1px solid var(--sc-border);
        border-radius: 4px;
        font-family: monospace;
        font-size: 13px;
        background: var(--sc-panel-bg);
        color: var(--sc-panel-fg);
    }
    .feed-url-input input:focus {
        outline: none;
        border-color: var(--sc-primary);
        box-shadow: 0 0 0 2px color-mix(in srgb, var(--sc-primary) 25%, transparent);
    }
    .copy-btn {
        padding: 10px 16px;
        background: var(--sc-primary);
        color: var(--sc-primary-fg);
        border: none;
        border-radius: 4px;
        font-weight: 600;
        cursor: pointer;
        white-space: nowrap;
    }
    .copy-btn:hover {
        filter: brightness(1.05);
    }
    .copy-btn.copied {
        background: #22c55e;
    }
    .feed-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        flex-wrap: wrap;
    }
    .feed-actions a {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px;
        background: var(--sc-surface);
        border: 1px solid var(--sc-border);
        border-radius: 4px;
        color: var(--sc-panel-fg);
        text-decoration: none;
        font-size: 13px;
        font-weight: 500;
    }
    .feed-actions a:hover {
        border-color: var(--sc-primary);
        background: color-mix(in srgb, var(--sc-primary) 10%, transparent);
    }
    @media (max-width: 600px) {
        .feed-card {
            flex-direction: column;
        }
        .feed-card img {
            width: 80px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h1>RSS Feed Links</h1>

    <div class="explainer">
        <strong>Subscribe to your feeds</strong><br>
        Copy these URLs to subscribe in your favorite podcast app (Overcast, Pocket Casts, Apple Podcasts, etc.).
        {% if require_user_token_for_feeds %}
        The URLs include your private token for secure access.
        {% endif %}
    </div>

    {% if require_user_token_for_feeds %}
    <div class="status-info protected">
        <span class="status-info-icon">üîí</span>
        <div>
            <strong>Feed Protection Enabled</strong><br>
            Your RSS feeds require a user token. Keep these URLs private - they grant access to your feeds.
        </div>
    </div>
    {% else %}
    <div class="status-info public">
        <span class="status-info-icon">üåê</span>
        <div>
            <strong>Public Feeds</strong><br>
            RSS feeds are currently publicly accessible. To require user tokens for feeds, set <code>REQUIRE_USER_TOKEN_FOR_FEEDS=true</code> in your environment configuration.
        </div>
    </div>
    {% endif %}

    <h2>Available Feeds</h2>

    <div class="feed-card">
        <img src="{% static 'media/feed-logo-audio.png' %}" alt="Audio feed">
        <div class="feed-card-content">
            <h3>Audio Feed</h3>
            <p style="margin: 0 0 10px 0; color: var(--sc-muted); font-size: 14px;">Audio-only content for listening on the go</p>
            <div class="feed-url-group">
                <label>Subscribe URL:</label>
                <div class="feed-url-input">
                    <input type="text" readonly value="{{ base_url }}/feeds/audio.xml{% if require_user_token_for_feeds %}?token={{ user_token }}{% endif %}" id="audio-url">
                    <button class="copy-btn" data-target="audio-url">Copy</button>
                </div>
            </div>
            <div class="feed-actions">
                <a href="/admin/tools/grid/?type=audio">Grid View</a>
                <a href="/admin/tools/list/?type=audio">List View</a>
                <a href="/feeds/audio.xml?{% if require_user_token_for_feeds %}token={{ user_token }}&{% endif %}view=1" target="_blank">View XML</a>
                <a href="/admin/media/mediaitem/?media_type=audio">Manage</a>
            </div>
        </div>
    </div>

    <div class="feed-card">
        <img src="{% static 'media/feed-logo-video.png' %}" alt="Video feed">
        <div class="feed-card-content">
            <h3>Video Feed</h3>
            <p style="margin: 0 0 10px 0; color: var(--sc-muted); font-size: 14px;">Video content for watching later</p>
            <div class="feed-url-group">
                <label>Subscribe URL:</label>
                <div class="feed-url-input">
                    <input type="text" readonly value="{{ base_url }}/feeds/video.xml{% if require_user_token_for_feeds %}?token={{ user_token }}{% endif %}" id="video-url">
                    <button class="copy-btn" data-target="video-url">Copy</button>
                </div>
            </div>
            <div class="feed-actions">
                <a href="/admin/tools/grid/?type=video">Grid View</a>
                <a href="/admin/tools/list/?type=video">List View</a>
                <a href="/feeds/video.xml?{% if require_user_token_for_feeds %}token={{ user_token }}&{% endif %}view=1" target="_blank">View XML</a>
                <a href="/admin/media/mediaitem/?media_type=video">Manage</a>
            </div>
        </div>
    </div>

    <div class="feed-card">
        <img src="{% static 'media/feed-logo-combined.png' %}" alt="Combined feed">
        <div class="feed-card-content">
            <h3>Combined Feed</h3>
            <p style="margin: 0 0 10px 0; color: var(--sc-muted); font-size: 14px;">All content in one feed</p>
            <div class="feed-url-group">
                <label>Subscribe URL:</label>
                <div class="feed-url-input">
                    <input type="text" readonly value="{{ base_url }}/feeds/combined.xml{% if require_user_token_for_feeds %}?token={{ user_token }}{% endif %}" id="combined-url">
                    <button class="copy-btn" data-target="combined-url">Copy</button>
                </div>
            </div>
            <div class="feed-actions">
                <a href="/admin/tools/grid/?type=all">Grid View</a>
                <a href="/admin/tools/list/?type=all">List View</a>
                <a href="/feeds/combined.xml?{% if require_user_token_for_feeds %}token={{ user_token }}&{% endif %}view=1" target="_blank">View XML</a>
                <a href="/admin/media/mediaitem/">Manage</a>
            </div>
        </div>
    </div>
</div>

<script>
    document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
            const targetId = btn.dataset.target;
            const input = document.getElementById(targetId);
            try {
                await navigator.clipboard.writeText(input.value);
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'Copy';
                    btn.classList.remove('copied');
                }, 1500);
            } catch (e) {
                btn.textContent = 'Failed';
                setTimeout(() => btn.textContent = 'Copy', 1500);
            }
        });
    });
</script>
{% endblock %}
