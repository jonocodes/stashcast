{% extends "admin/base_site.html" %}
{% load media_filters %}
{% load static %}

{% block title %}{{ item.title|default:"Untitled" }} - StashCast{% endblock %}

{% block extrastyle %}
<style>
    .item-detail-container {
        max-width: 1000px;
        margin: 20px auto;
        padding: 20px;
        background: var(--body-bg);
        border: 1px solid var(--border-color, #ddd);
        border-radius: 8px;
    }
    .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 20px;
    }
    .status-ready { background: color-mix(in srgb, #28a745 25%, transparent); color: #28a745; }
    .status-error { background: color-mix(in srgb, #dc3545 25%, transparent); color: #dc3545; }
    .status-processing { background: color-mix(in srgb, #ffc107 25%, transparent); color: #b38600; }
    .status-downloading { background: color-mix(in srgb, #17a2b8 25%, transparent); color: #17a2b8; }
    .status-prefetching { background: color-mix(in srgb, #6c757d 25%, transparent); color: var(--body-quiet-color, #6c757d); }
    h1 {
        margin: 0 0 10px 0;
        color: var(--body-fg);
    }
    .metadata {
        color: var(--body-quiet-color, #666);
        font-size: 14px;
        margin-bottom: 20px;
    }
    .metadata div {
        margin-bottom: 5px;
    }
    .thumbnail {
        width: 100%;
        max-width: 400px;
        margin: 20px 0;
        border-radius: 4px;
    }
    .summary {
        background: var(--darkened-bg, rgba(0,0,0,0.02));
        border-left: 4px solid var(--primary, #417690);
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
    }
    .summary h3 {
        margin: 0 0 10px 0;
        color: var(--primary, #417690);
        font-size: 16px;
    }
    .description {
        line-height: 1.6;
        color: var(--body-fg);
        white-space: pre-wrap;
    }
    .description h3 {
        margin: 0 0 10px 0;
        color: var(--body-fg);
    }
    .player {
        margin: 30px 0;
        width: 100%;
    }
    audio, video {
        width: 100%;
        border-radius: 4px;
    }
    .links {
        margin: 20px 0;
        padding: 20px;
        background: var(--darkened-bg, rgba(0,0,0,0.02));
        border-radius: 4px;
    }
    .links h3 {
        margin: 0 0 15px 0;
        color: var(--body-fg);
    }
    .links a {
        display: inline-block;
        margin-right: 15px;
        color: var(--primary, #417690);
        text-decoration: none;
        font-weight: 500;
    }
    .links a:hover {
        text-decoration: underline;
    }
    .error-message {
        background: color-mix(in srgb, #dc3545 15%, transparent);
        border: 1px solid color-mix(in srgb, #dc3545 40%, transparent);
        color: #dc3545;
        padding: 15px;
        border-radius: 4px;
        margin: 20px 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="item-detail-container">
    {% if item.status == 'READY' %}
        <span class="status-badge status-ready">Ready</span>
    {% elif item.status == 'ERROR' %}
        <span class="status-badge status-error">Error</span>
    {% elif item.status == 'PROCESSING' %}
        <span class="status-badge status-processing">Processing</span>
    {% elif item.status == 'DOWNLOADING' %}
        <span class="status-badge status-downloading">Downloading</span>
    {% else %}
        <span class="status-badge status-prefetching">Prefetching</span>
    {% endif %}

    <h1>{{ item.title|default:"Untitled" }}</h1>

    <div class="metadata">
        {% if item.author %}
            <div><strong>By:</strong> {{ item.author }}</div>
        {% endif %}
        {% if item.publish_date %}
            <div><strong>Published:</strong> {{ item.publish_date|date:"F j, Y" }}</div>
        {% endif %}
        {% if item.duration_seconds %}
            <div><strong>Duration:</strong> {{ item.duration_seconds|duration }}</div>
        {% endif %}
        <div><strong>Type:</strong> {{ item.media_type|title }}</div>
    </div>

    {% if item.has_error %}
        <div class="error-message">
            <strong>Error:</strong> {{ item.error_message }}
        </div>
    {% endif %}

    {% if item.thumbnail_path and thumbnail_url %}
        <img src="{{ thumbnail_url }}" alt="{{ item.title }}" class="thumbnail">
    {% endif %}

    {% if item.summary %}
        <div class="summary">
            <h3>Summary</h3>
            <p>{{ item.summary }}</p>
        </div>
    {% endif %}

    {% if item.description %}
        <div class="description">
            <h3>Description</h3>
            {{ item.description }}
        </div>
    {% endif %}

    {% if item.is_ready and media_url %}
        <div class="player">
            {% if item.media_type == 'audio' %}
                <audio controls>
                    <source src="{{ media_url }}" type="{{ item.mime_type }}">
                    Your browser does not support audio element.
                </audio>
            {% else %}
                <video controls>
                    <source src="{{ media_url }}" type="{{ item.mime_type }}">
                    {% if subtitle_url %}
                        <track kind="subtitles" src="{{ subtitle_url }}" srclang="en" label="English">
                    {% endif %}
                    Your browser does not support video element.
                </video>
            {% endif %}
        </div>

        <div class="links">
            <h3>Downloads</h3>
            <a href="{{ media_url }}" download>Download {{ item.media_type|title }}</a>
            {% if subtitle_url %}
                <a href="{{ subtitle_url }}" download>Download Subtitles</a>
            {% endif %}
        </div>
    {% endif %}

    {% if item.webpage_url %}
        <div class="links">
            <a href="{{ item.webpage_url }}" target="_blank">View Original Source</a>
        </div>
    {% endif %}
</div>
{% endblock %}
